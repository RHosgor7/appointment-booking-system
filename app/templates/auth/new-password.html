<!DOCTYPE html>
<!--
Author: Keenthemes
Product Name: MetronicProduct Version: 8.2.9
Purchase: https://1.envato.market/Vm7VRE
Website: http://www.keenthemes.com
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Dribbble: www.dribbble.com/keenthemes
Like: www.facebook.com/keenthemes
License: For each use you must have a valid license purchased only from above link in order to legally use the theme for your project.
-->
<html lang="en">
	<!--begin::Head-->
	<head>
<!-- base href removed for FastAPI -->
		<title>Setup New Password - Appointment Booking System</title>
		<meta charset="utf-8" />
		<meta name="description" content="Setup your new password" />
		<meta name="keywords" content="appointment, booking, system, new password" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta property="og:locale" content="en_US" />
		<meta property="og:type" content="article" />
		<meta property="og:title" content="Setup New Password - Appointment Booking System" />
		<link rel="shortcut icon" href="/static/assets/logos/favicon.png" />
		<!--begin::Fonts(mandatory for all pages)-->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
		<!--end::Fonts-->
		<!--begin::Global Stylesheets Bundle(mandatory for all pages)-->
		<link href="/static/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/style.bundle.css" rel="stylesheet" type="text/css" />
		<!--end::Global Stylesheets Bundle-->
		<script>// Frame-busting to prevent site from being loaded within a frame without permission (click-jacking) if (window.top != window.self) { window.top.location.replace(window.self.location.href); }</script>
	</head>
	<!--end::Head-->
	<!--begin::Body-->
	<body id="kt_body" class="app-blank bgi-size-cover bgi-attachment-fixed bgi-position-center">
		<!--begin::Theme mode setup on page load-->
		<script>var defaultThemeMode = "light"; var themeMode; if ( document.documentElement ) { if ( document.documentElement.hasAttribute("data-bs-theme-mode")) { themeMode = document.documentElement.getAttribute("data-bs-theme-mode"); } else { if ( localStorage.getItem("data-bs-theme") !== null ) { themeMode = localStorage.getItem("data-bs-theme"); } else { themeMode = defaultThemeMode; } } if (themeMode === "system") { themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"; } document.documentElement.setAttribute("data-bs-theme", themeMode); }</script>
		<!--end::Theme mode setup on page load-->
		<!--begin::Root-->
		<div class="d-flex flex-column flex-root" id="kt_app_root">
			<!--begin::Page bg image-->
			<style>body { background-image: url('/static/assets/auth/bg10.jpeg'); } [data-bs-theme="dark"] body { background-image: url('/static/assets/auth/bg10-dark.jpeg'); }</style>
			<!--end::Page bg image-->
			<!--begin::Authentication - New password -->
			<div class="d-flex flex-column flex-lg-row flex-column-fluid">
				<!--begin::Aside-->
				<div class="d-flex flex-lg-row-fluid">
					<!--begin::Content-->
					<div class="d-flex flex-column flex-center pb-0 pb-lg-10 p-10 w-100">
						<!--begin::Image-->
						<img class="theme-light-show mx-auto mw-100 w-150px w-lg-300px mb-10 mb-lg-20" src="/static/assets/auth/agency.png" alt="" />
						<img class="theme-dark-show mx-auto mw-100 w-150px w-lg-300px mb-10 mb-lg-20" src="/static/assets/auth/agency-dark.png" alt="" />
						<!--end::Image-->
						<!--begin::Title-->
						<h1 class="text-gray-800 fs-2qx fw-bold text-center mb-7">Fast, Efficient and Productive</h1>
						<!--end::Title-->
						<!--begin::Text-->
						<div class="text-gray-600 fs-base text-center fw-semibold">In this kind of post, 
						<a href="#" class="opacity-75-hover text-primary me-1">the blogger</a>introduces a person they've interviewed 
						<br />and provides some background information about 
						<a href="#" class="opacity-75-hover text-primary me-1">the interviewee</a>and their 
						<br />work following this is a transcript of the interview.</div>
						<!--end::Text-->
					</div>
					<!--end::Content-->
				</div>
				<!--begin::Aside-->
				<!--begin::Body-->
				<div class="d-flex flex-column-fluid flex-lg-row-auto justify-content-center justify-content-lg-end p-12">
					<!--begin::Wrapper-->
					<div class="bg-body d-flex flex-column flex-center rounded-4 w-md-600px p-10">
						<!--begin::Content-->
						<div class="d-flex flex-center flex-column align-items-stretch h-lg-100 w-md-400px">
							<!--begin::Wrapper-->
							<div class="d-flex flex-center flex-column flex-column-fluid pb-15 pb-lg-20">
								<!--begin::Form-->
								<form class="form w-100" novalidate="novalidate" id="kt_new_password_form" data-kt-redirect-url="/login" action="#">
									<!--begin::Heading-->
									<div class="text-center mb-11">
										<!--begin::Title-->
										<h1 class="text-gray-900 fw-bolder mb-3">Setup New Password</h1>
										<!--end::Title-->
										<!--begin::Subtitle-->
										<div class="text-gray-500 fw-semibold fs-6">Have you already reset the password ? 
										<a href="/login" class="link-primary fw-bold">Sign in</a></div>
										<!--end::Subtitle=-->
									</div>
									<!--begin::Heading-->
									<!--begin::Code Input-->
									<div class="mb-10">
										<!--begin::Label-->
										<div class="fw-bold text-start text-gray-900 fs-6 mb-1 ms-1">Type your 6 digit security code</div>
										<!--end::Label-->
										<!--begin::Input group-->
										<div class="d-flex flex-wrap flex-stack">
											<input type="text" name="code_1" maxlength="1" class="form-control bg-transparent h-60px w-60px fs-2qx text-center mx-1 my-2 code-input" value="" inputmode="numeric" pattern="[0-9]" />
											<input type="text" name="code_2" maxlength="1" class="form-control bg-transparent h-60px w-60px fs-2qx text-center mx-1 my-2 code-input" value="" inputmode="numeric" pattern="[0-9]" />
											<input type="text" name="code_3" maxlength="1" class="form-control bg-transparent h-60px w-60px fs-2qx text-center mx-1 my-2 code-input" value="" inputmode="numeric" pattern="[0-9]" />
											<input type="text" name="code_4" maxlength="1" class="form-control bg-transparent h-60px w-60px fs-2qx text-center mx-1 my-2 code-input" value="" inputmode="numeric" pattern="[0-9]" />
											<input type="text" name="code_5" maxlength="1" class="form-control bg-transparent h-60px w-60px fs-2qx text-center mx-1 my-2 code-input" value="" inputmode="numeric" pattern="[0-9]" />
											<input type="text" name="code_6" maxlength="1" class="form-control bg-transparent h-60px w-60px fs-2qx text-center mx-1 my-2 code-input" value="" inputmode="numeric" pattern="[0-9]" />
										</div>
										<!--end::Input group-->
									</div>
									<!--end::Code Input-->
									<!--begin::Input group-->
									<div class="fv-row mb-8" data-kt-password-meter="true">
										<!--begin::Wrapper-->
										<div class="mb-1">
											<!--begin::Input wrapper-->
											<div class="position-relative mb-3">
												<input class="form-control bg-transparent" type="password" placeholder="Password" name="password" autocomplete="off" required />
												<span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2" data-kt-password-meter-control="visibility">
													<i class="ki-duotone ki-eye-slash fs-2"></i>
													<i class="ki-duotone ki-eye fs-2 d-none"></i>
												</span>
											</div>
											<!--end::Input wrapper-->
											<!--begin::Meter-->
											<div class="d-flex align-items-center mb-3" data-kt-password-meter-control="highlight">
												<div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
												<div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
												<div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"></div>
												<div class="flex-grow-1 bg-secondary bg-active-success rounded h-5px"></div>
											</div>
											<!--end::Meter-->
										</div>
										<!--end::Wrapper-->
										<!--begin::Hint-->
										<div class="text-muted">Use 8 or more characters with a mix of letters, numbers & symbols.</div>
										<!--end::Hint-->
									</div>
									<!--end::Input group=-->
									<!--end::Input group=-->
									<div class="fv-row mb-8">
										<!--begin::Repeat Password-->
										<input type="password" placeholder="Repeat Password" name="confirm-password" autocomplete="off" class="form-control bg-transparent" required />
										<!--end::Repeat Password-->
									</div>
									<!--end::Input group=-->
									<!--begin::Input group=-->
									<div class="fv-row mb-8">
										<label class="form-check form-check-inline">
											<input class="form-check-input" type="checkbox" name="toc" value="1" required />
											<span class="form-check-label fw-semibold text-gray-700 fs-6 ms-1">I Agree & 
											<a href="#" class="ms-1 link-primary">Terms and conditions</a>.</span>
										</label>
									</div>
									<!--end::Input group=-->
									<!--begin::Action-->
									<div class="d-grid mb-10">
										<button type="submit" id="kt_new_password_submit" class="btn btn-primary">
											<!--begin::Indicator label-->
											<span class="indicator-label">Submit</span>
											<!--end::Indicator label-->
											<!--begin::Indicator progress-->
											<span class="indicator-progress">Please wait... 
											<span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
											<!--end::Indicator progress-->
										</button>
									</div>
									<!--end::Action-->
								</form>
								<!--end::Form-->
							</div>
							<!--end::Wrapper-->
							<!--begin::Footer-->
							<div class="d-flex flex-stack">
								<!--begin::Languages-->
								<div class="me-10">
									<!--begin::Toggle-->
									<button class="btn btn-flex btn-link btn-color-gray-700 btn-active-color-primary rotate fs-base" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-start" data-kt-menu-offset="0px, 0px">
										<img data-kt-element="current-lang-flag" class="w-20px h-20px rounded me-3" src="/static/assets/flags/united-states.svg" alt="" />
										<span data-kt-element="current-lang-name" class="me-1">English</span>
										<i class="ki-duotone ki-down fs-5 text-muted rotate-180 m-0"></i>
									</button>
									<!--end::Toggle-->
									<!--begin::Menu-->
									<div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px py-4 fs-7" data-kt-menu="true" id="kt_auth_lang_menu">
										<!--begin::Menu item-->
										<div class="menu-item px-3">
											<a href="#" class="menu-link d-flex px-5" data-kt-lang="English">
												<span class="symbol symbol-20px me-4">
													<img data-kt-element="lang-flag" class="rounded-1" src="/static/assets/flags/united-states.svg" alt="" />
												</span>
												<span data-kt-element="lang-name">English</span>
											</a>
										</div>
										<!--end::Menu item-->
										<!--begin::Menu item-->
										<div class="menu-item px-3">
											<a href="#" class="menu-link d-flex px-5" data-kt-lang="Spanish">
												<span class="symbol symbol-20px me-4">
													<img data-kt-element="lang-flag" class="rounded-1" src="/static/assets/flags/spain.svg" alt="" />
												</span>
												<span data-kt-element="lang-name">Spanish</span>
											</a>
										</div>
										<!--end::Menu item-->
										<!--begin::Menu item-->
										<div class="menu-item px-3">
											<a href="#" class="menu-link d-flex px-5" data-kt-lang="German">
												<span class="symbol symbol-20px me-4">
													<img data-kt-element="lang-flag" class="rounded-1" src="/static/assets/flags/germany.svg" alt="" />
												</span>
												<span data-kt-element="lang-name">German</span>
											</a>
										</div>
										<!--end::Menu item-->
										<!--begin::Menu item-->
										<div class="menu-item px-3">
											<a href="#" class="menu-link d-flex px-5" data-kt-lang="Japanese">
												<span class="symbol symbol-20px me-4">
													<img data-kt-element="lang-flag" class="rounded-1" src="/static/assets/flags/japan.svg" alt="" />
												</span>
												<span data-kt-element="lang-name">Japanese</span>
											</a>
										</div>
										<!--end::Menu item-->
										<!--begin::Menu item-->
										<div class="menu-item px-3">
											<a href="#" class="menu-link d-flex px-5" data-kt-lang="French">
												<span class="symbol symbol-20px me-4">
													<img data-kt-element="lang-flag" class="rounded-1" src="/static/assets/flags/france.svg" alt="" />
												</span>
												<span data-kt-element="lang-name">French</span>
											</a>
										</div>
										<!--end::Menu item-->
									</div>
									<!--end::Menu-->
								</div>
								<!--end::Languages-->
								<!--begin::Links-->
								<div class="d-flex fw-semibold text-primary fs-base gap-5">
									<a href="pages/team.html" target="_blank">Terms</a>
									<a href="pages/pricing/column.html" target="_blank">Plans</a>
									<a href="pages/contact.html" target="_blank">Contact Us</a>
								</div>
								<!--end::Links-->
							</div>
							<!--end::Footer-->
						</div>
						<!--end::Content-->
					</div>
					<!--end::Wrapper-->
				</div>
				<!--end::Body-->
			</div>
			<!--end::Authentication - New password-->
		</div>
		<!--end::Root-->
		<!--begin::Javascript-->
		<script>var hostUrl = "/static/";</script>
		<!--begin::Global Javascript Bundle(mandatory for all pages)-->
		<script src="/static/plugins/global/plugins.bundle.js"></script>
		<script src="/static/js/scripts.bundle.js"></script>
		<!--end::Global Javascript Bundle-->
		<!--begin::Custom Javascript(used for this page only)-->
		<!--begin::New Password API Integration-->
		<script>
		document.addEventListener('DOMContentLoaded', function() {
			const form = document.querySelector('#kt_new_password_form');
			const submitButton = document.querySelector('#kt_new_password_submit');
			const codeInputs = document.querySelectorAll('.code-input');
			
			// Code input navigation - auto-focus next input
			codeInputs.forEach((input, index) => {
				input.addEventListener('input', function(e) {
					// Only allow numbers
					this.value = this.value.replace(/[^0-9]/g, '');
					
					// Auto-focus next input if value entered
					if (this.value && index < codeInputs.length - 1) {
						codeInputs[index + 1].focus();
					}
				});
				
				input.addEventListener('keydown', function(e) {
					// Backspace: focus previous input if current is empty
					if (e.key === 'Backspace' && !this.value && index > 0) {
						codeInputs[index - 1].focus();
					}
				});
				
				input.addEventListener('paste', function(e) {
					e.preventDefault();
					const paste = (e.clipboardData || window.clipboardData).getData('text');
					const numbers = paste.replace(/[^0-9]/g, '').slice(0, 6);
					
					// Fill inputs with pasted numbers
					for (let i = 0; i < numbers.length && (index + i) < codeInputs.length; i++) {
						codeInputs[index + i].value = numbers[i];
					}
					
					// Focus last filled input or next empty
					if (index + numbers.length < codeInputs.length) {
						codeInputs[index + numbers.length].focus();
					} else {
						codeInputs[codeInputs.length - 1].focus();
					}
				});
			});
			
			if (form && submitButton) {
				const passwordInput = form.querySelector('[name="password"]');
				const confirmPasswordInput = form.querySelector('[name="confirm-password"]');
				const tocCheckbox = form.querySelector('[name="toc"]');
				
				// Password confirmation validation
				if (confirmPasswordInput && passwordInput) {
					confirmPasswordInput.addEventListener('blur', function() {
						if (this.value && this.value !== passwordInput.value) {
							this.classList.add('is-invalid');
						} else {
							this.classList.remove('is-invalid');
						}
					});
					
					passwordInput.addEventListener('input', function() {
						if (confirmPasswordInput.value && confirmPasswordInput.value !== this.value) {
							confirmPasswordInput.classList.add('is-invalid');
						} else {
							confirmPasswordInput.classList.remove('is-invalid');
						}
					});
				}
				
				form.addEventListener('submit', async function(e) {
					e.preventDefault();
					
					// Get code from inputs
					const code = Array.from(codeInputs).map(input => input.value).join('');
					
					// Validate code - must be "123456"
					if (code !== '123456') {
						Swal.fire({
							text: "Invalid security code. Please enter the correct 6-digit code.",
							icon: "error",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn btn-primary"
							}
						});
						return;
					}
					
					const password = passwordInput.value;
					const confirmPassword = confirmPasswordInput.value;
					const tocAccepted = tocCheckbox.checked;
					
					// Validation
					if (!password || password.length < 8) {
						Swal.fire({
							text: "Password must be at least 8 characters long",
							icon: "error",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn btn-primary"
							}
						});
						return;
					}
					
					if (password !== confirmPassword) {
						Swal.fire({
							text: "Passwords do not match",
							icon: "error",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn btn-primary"
							}
						});
						return;
					}
					
					if (!tocAccepted) {
						Swal.fire({
							text: "Please accept the Terms and Conditions",
							icon: "error",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn btn-primary"
							}
						});
						return;
					}
					
					// Get email from localStorage
					const email = localStorage.getItem('password_reset_email');
					
					if (!email) {
						Swal.fire({
							text: "Email not found. Please start the password reset process again.",
							icon: "error",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn btn-primary"
							}
						}).then(function() {
							window.location.href = '/reset-password';
						});
						return;
					}
					
					// Show loading indication
					submitButton.setAttribute('data-kt-indicator', 'on');
					submitButton.disabled = true;
					
					try {
						// API çağrısı yap
						const response = await fetch('/api/auth/new-password', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({
								email: email,
								code: code,
								password: password,
								confirm_password: confirmPassword
							})
						});
						
						const data = await response.json();
						
						if (!response.ok) {
							throw new Error(data.detail || 'Failed to reset password');
						}
						
						// Email'i localStorage'dan temizle
						localStorage.removeItem('password_reset_email');
						
						// Başarı mesajı
						Swal.fire({
							text: data.message || "Password has been reset successfully!",
							icon: "success",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn btn-primary"
							}
						}).then(function() {
							// Redirect to login
							const redirectUrl = form.getAttribute('data-kt-redirect-url') || '/login';
							window.location.href = redirectUrl;
						});
						
					} catch (error) {
						Swal.fire({
							text: error.message || "An error occurred. Please try again later.",
							icon: "error",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn btn-primary"
							}
						});
						
						submitButton.removeAttribute('data-kt-indicator');
						submitButton.disabled = false;
					}
				});
			}
		});
		</script>
		<!--end::New Password API Integration-->
		<!--end::Custom Javascript-->
		<!--end::Javascript-->
	</body>
	<!--end::Body-->
</html>

